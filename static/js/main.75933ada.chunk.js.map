{"version":3,"sources":["logo.svg","App.js","index.js"],"names":["initialState","answers","questionnaire","item","reduce","prev","e","linkId","generateQuestionnaireResponse","state","resourceType","status","subject","identifier","value","authored","Date","toISOString","map","text","definition","answer","checkStateValidity","question","required","length","type","getPath","test","beforeDownload","form","document","getElementsByTagName","checkValidity","reportValidity","checkFormValidity","preventDefault","reducer","action","currentAnswers","answerIndex","findIndex","x","valueCoding","code","splice","push","valueUri","obj","path","split","out","key","undefined","Question","extension","dispatch","label","note","Array","isArray","ext","find","url","valueString","className","style","marginBottom","Answers","questionId","contained","id","answerValueSet","compose","include","concept","system","repeats","currentAnswer","CheckBox","attrs","name","checked","onChange","display","description","URLInput","target","placeholder","pattern","App","useReducer","href","src","logo","alt","height","verticalAlign","marginRight","fontSize","onSubmit","onClick","encodeURIComponent","JSON","stringify","download","margin","customStyle","background","language","atomOneLight","rel","ReactDOM","render","StrictMode","getElementById"],"mappings":"qOAAe,MAA0B,iC,yBCMnCA,EAAe,CACnBC,QAASC,EAAcC,KAAKC,QAAO,SAACC,EAAMC,GAExC,OADAD,EAAKC,EAAEC,QAAU,GACVF,IACN,KAIL,SAASG,EAA8BC,GACrC,MAAO,CACLC,aAAe,wBACfC,OAAe,YACfT,cAAe,0DACfU,QAAe,YACfC,WAAY,CACVC,MAAO,kCAETC,UAAU,IAAIC,MAAOC,cACrBd,KAAMD,EAAcC,KAAKe,KAAI,SAAAf,GAC3B,MAAO,CACLI,OAAQJ,EAAKI,OACbY,KAAQhB,EAAKgB,KACbC,WAAY,4CACZC,OAAQZ,EAAMR,QAAQE,EAAKI,aAMnC,SAASe,EAAmBb,GAAQ,IAAD,gBACZP,EAAcC,MADF,IACjC,2BAAyC,CAAC,IAAjCoB,EAAgC,QACjCtB,EAAUQ,EAAMR,QAAQsB,EAAShB,QACvC,GAAIgB,EAASC,WACNvB,EAAQwB,OAEX,OAAO,EAGX,GAAsB,QAAlBF,EAASG,KAAgB,CAC3B,IAAIL,EAASM,EAAQ1B,EAAS,eAAiB,GAC/C,GAAIoB,IAAW,iBAAiBO,KAAKP,GAEnC,OAAO,IAboB,8BAiBjC,OAAO,EAYT,SAASQ,EAAevB,IATxB,WACE,IAAMwB,EAAOC,SAASC,qBAAqB,QAAQ,GACnD,QAAKF,EAAKG,kBACRH,EAAKI,kBACE,IAMJC,IACH7B,EAAE8B,iBAIN,SAASC,EAAQ5B,EAAO6B,GACtB,OAAOA,EAAOZ,MACZ,IAAK,kBACH,IAAMa,EAAc,YAAO9B,EAAMR,QAAQqC,EAAO/B,SAC1CiC,EAAcD,EAAeE,WAAU,SAAAC,GAAC,OAAIA,EAAEC,YAAYC,OAASN,EAAOxB,MAAM6B,YAAYC,QAMlG,OALIJ,GAAe,EACjBD,EAAeM,OAAOL,EAAa,GAEnCD,EAAeO,KAAKR,EAAOxB,OAEtB,2BACFL,GADL,IAEER,QAAQ,2BACHQ,EAAMR,SADJ,kBAEJqC,EAAO/B,OAASgC,MAKvB,IAAK,gBACH,OAAO,2BACF9B,GADL,IAEER,QAAQ,2BACHQ,EAAMR,SADJ,kBAEJqC,EAAO/B,OAASE,EAAMR,QAAQqC,EAAO/B,QAAQkC,WAC5C,SAAAC,GAAC,OAAIA,EAAEC,YAAYC,OAASN,EAAOxB,MAAM6B,YAAYC,SAClD,EAAI,GAAK,CAACN,EAAOxB,WAK5B,IAAK,UACH,IAAMb,EAAO,2BACNQ,EAAMR,SADA,kBAERqC,EAAO/B,OAAS,CAAC,CAAEwC,SAAUT,EAAOxB,UAEzC,OAAO,2BACFL,GADL,IAEER,YAEJ,QACI,OAAOQ,GAIf,SAASkB,EAAQqB,GAAiB,IAAZC,EAAW,uDAAJ,GACzB,OAAOA,EAAKC,MAAM,KAAK9C,QAAO,SAAC+C,EAAKC,GAAN,OAAcD,EAAMA,EAAIC,QAAOC,IAAWL,GAG5E,SAASM,EAAT,GAAwE,IAApDnC,EAAmD,EAAnDA,KAAmD,IAA7CoC,iBAA6C,MAAjC,KAAiC,EAA3BhD,EAA2B,EAA3BA,OAAQE,EAAmB,EAAnBA,MAAO+C,EAAY,EAAZA,SACrDC,EAAQtC,EACRuC,EAAQ,KAEZ,GAAIC,MAAMC,QAAQL,GAAY,CAC5B,IAAIM,EAAMN,EAAUO,MAAK,SAAApB,GAAC,MAAc,+EAAVA,EAAEqB,OAC5BF,GAAOA,EAAIG,cACbN,EAAOD,EACPA,EAAQI,EAAIG,aAGhB,OACE,sBAAKC,UAAU,WAAWC,MAAO,CAAEC,aAAc,QAAjD,UACE,oBAAIF,UAAU,eAAd,SAA+BR,IAC/B,uBACEC,GAAQ,mBAAGO,UAAU,YAAb,SAA2BP,IACrC,cAACU,EAAD,CAASC,WAAY9D,EAAQE,MAAOA,EAAO+C,SAAUA,OAK3D,SAASY,EAAT,GAAmD,IAAhCC,EAA+B,EAA/BA,WAAY5D,EAAmB,EAAnBA,MAAO+C,EAAY,EAAZA,SAC9BjC,EAAWrB,EAAcC,KAAK2D,MAAK,SAAApB,GAAC,OAAIA,EAAEnC,SAAW8D,KAE3D,GAAsB,WAAlB9C,EAASG,KAAmB,CAAC,IAAD,EAEFxB,EAAcoE,UAAUR,MAClD,SAAApB,GAAC,MAAI,WAAIA,EAAE6B,MAAShD,EAASiD,kBAC7BC,QAAQC,QAAQ,GAFVC,EAFsB,EAEtBA,QAASC,EAFa,EAEbA,OAIjB,OAAIrD,EAASsD,QACJ,mCAAGF,EAAQzD,KAAI,SAAA4D,GAAa,OAAI,cAACC,EAAD,CAEnCC,MAAO,CACLC,KAAMH,EAAclC,KACpBsC,QAASzE,EAAMR,QAAQoE,GAAY5B,WAAU,SAAAC,GAAC,OAAIA,EAAEC,YAAYC,OAASkC,EAAclC,SAAS,EAChGuC,SAAU,WACR3B,EAAS,CACP9B,KAAM,kBACNnB,OAAQ8D,EACRvD,MAAO,CACL6B,YAAa,CACTiC,SACAhC,KAAMkC,EAAclC,KACpBwC,QAASN,EAAcM,cAMnC3B,MAAQqB,EAAcM,QACtBC,YAAc1D,EAAQmD,EAAe,wBAA0B,MApB5B,UAC3BT,EAD2B,YACbS,EAAclC,YAwBjC,mCAAG+B,EAAQzD,KAAI,SAAA4D,GAAa,OAAI,cAACC,EAAD,CAEnCC,MAAO,CACLC,KAAMH,EAAclC,KACpBlB,KAAM,QACNwD,QAASzE,EAAMR,QAAQoE,GAAY5B,WAAU,SAAAC,GAAC,OAAIA,EAAEC,YAAYC,OAASkC,EAAclC,SAAS,EAChGuC,SAAU,WACR3B,EAAS,CACP9B,KAAM,gBACNnB,OAAQ8D,EACRvD,MAAO,CACL6B,YAAa,CACTiC,SACAhC,KAAMkC,EAAclC,KACpBwC,QAASN,EAAcM,cAMnC3B,MAAQqB,EAAcM,QACtBC,YAAc1D,EAAQmD,EAAe,wBAA0B,MArB5B,UAC3BT,EAD2B,YACbS,EAAclC,YAwBvC,MAAsB,QAAlBrB,EAASG,KACT,cAAC4D,EAAD,CACA/E,OAAQ8D,EACRvD,MAAOa,EAAQlB,EAAD,kBAAmB4D,EAAnB,iBAA+C,KAC7Dc,SAAU,SAAA7E,GAAUkD,EAAS,CAAE9B,KAAM,UAAWnB,OAAQ8D,EAAYvD,MAAOR,EAAEiF,OAAOzE,SACpFU,WAAYD,EAASC,WAIvB,KA8DT,SAAS8D,EAAT,GAAiE,IAA7C/E,EAA4C,EAA5CA,OAAQO,EAAoC,EAApCA,MAAOqE,EAA6B,EAA7BA,SAA6B,IAAnB3D,gBAAmB,SAC9D,OAAO,uBACLyC,UAAU,eACVvC,KAAK,MACLuD,KAAM1E,EACNgE,GAAIhE,EACJiF,YAAY,sBACZhE,SAAUA,EACViE,QAAQ,eACR3E,MAAOA,GAAS,GAChBqE,SAAUA,IAId,SAASJ,EAAT,GAAkD,IAA9BC,EAA6B,EAA7BA,MAAOvB,EAAsB,EAAtBA,MAAO4B,EAAe,EAAfA,YAChC,OACE,qBAAKpB,UAAU,aAAf,SACE,wBAAOA,UAAU,mBAAjB,UACE,+CACEvC,KAAK,YACAsD,GAFP,IAGEf,UAAU,sBAJd,IAKOR,EACH4B,GAAe,mBAAGpB,UAAU,aAAb,SAA4BoB,SAMtCK,MAxFf,WAAe,MAGaC,qBAAWtD,EAASrC,GAHjC,mBAGNS,EAHM,KAGC+C,EAHD,KAKb,OACE,sBAAKS,UAAU,MAAf,UACE,qBAAKA,UAAU,2DAAf,SACE,qBAAKA,UAAU,YAAf,SACE,oBAAGA,UAAU,eAAe2B,KAAK,IAAjC,UACE,qBAAKC,IAAKC,EAAM7B,UAAU,WAAW8B,IAAI,OAAO7B,MAAO,CACrD8B,OAAQ,QACRC,cAAe,MACfC,YAAa,SAJjB,mCASJ,uBAAMjC,UAAU,YAAYC,MAAO,CAAEiC,SAAU,QAA/C,UACE,uBACA,uBACA,uBAAMC,SAAU,SAAA9F,GAAC,OAAIA,EAAE8B,kBAAkB6B,UAAU,mBAAnD,UACE,qBAAKA,UAAU,MAAf,SACI/D,EAAcC,KAAKe,KAAI,SAAAf,GAAI,OAAI,cAACmD,EAAD,2BAAiCnD,GAAjC,IAAwCM,MAAOA,EAAO+C,SAAUA,IAAjDrD,EAAKI,aAEvD,sBAAK0D,UAAU,OAAf,UACE,qBAAIA,UAAU,cAAd,UACE,mBACEoC,QAASxE,EACToC,UAAW,8BACX2B,KAAM,uCAAyCU,mBAAmBC,KAAKC,UAAUhG,EAA8BC,GAAQ,KAAM,IAC7HgG,SAAS,wBACTvC,MAAO,CAAEwC,OAAQ,UALnB,sBADF,qBAQsBpF,EAAmBb,IAAU,gCAAO,mBAAGyD,MAAO,CAAE+B,cAAe,YAAahC,UAAU,qBAAlD,0BAE1D,qBAAKA,UAAU,YAAf,SACA,cAAC,IAAD,CAAmB0C,YAAa,CAAEC,WAAY,QAAUC,SAAS,OAAO3C,MAAO4C,IAA/E,SACIP,KAAKC,UAAUhG,EAA8BC,GAAQ,KAAM,aAKnE,uBACA,uBACA,uBACA,0BAEF,qBAAKwD,UAAU,4CAAf,SACE,qBAAKA,UAAU,YAAf,SACE,sBAAKA,UAAU,aAAf,wDAC6C,mBAAG2B,KAAK,IAAIL,OAAO,SAASwB,IAAI,aAAhC,6BCnQvDC,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFnF,SAASoF,eAAe,U","file":"static/js/main.75933ada.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.afa3dc39.svg\";","import logo from './logo.svg';\nimport questionnaire from \"./questionnaire.json\";\nimport { useReducer } from 'react';\nimport SyntaxHighlighter from 'react-syntax-highlighter';\nimport { atomOneLight } from 'react-syntax-highlighter/dist/esm/styles/hljs';\n\nconst initialState = {\n  answers: questionnaire.item.reduce((prev, e) => {\n    prev[e.linkId] = [];\n    return prev\n  }, {})\n};\n\n\nfunction generateQuestionnaireResponse(state) {\n  return {\n    resourceType : \"QuestionnaireResponse\",\n    status       : \"completed\",\n    questionnaire: \"http://privacy-manifest.smarthealthit.org/questionnaire\",\n    subject      : \"<subject>\",\n    identifier: {\n      value: \"<app-resource-identifying-uri>\"\n    },\n    authored: new Date().toISOString(),\n    item: questionnaire.item.map(item => {\n      return {\n        linkId: item.linkId,\n        text  : item.text,\n        definition: \"http://privacy-manifest.smarthealthit.org\",\n        answer: state.answers[item.linkId]\n      };\n    })\n  };\n}\n\nfunction checkStateValidity(state) {\n  for (let question of questionnaire.item) {\n    const answers = state.answers[question.linkId];\n    if (question.required) {\n      if (!answers.length) {\n        // console.log(`${question.linkId} is required`);\n        return false;\n      }\n    }\n    if (question.type === \"url\") {\n      let answer = getPath(answers, \"0.valueUri\") || \"\";\n      if (answer && !/^https?:\\/\\/.+/.test(answer)) {\n        // console.log(`${question.linkId} is invalid (${answer})`);\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nfunction checkFormValidity() {\n  const form = document.getElementsByTagName(\"form\")[0];\n  if (!form.checkValidity()) {\n    form.reportValidity();\n    return false;\n  }\n  return true;\n}\n\nfunction beforeDownload(e) {\n  if (!checkFormValidity()) {\n    e.preventDefault();\n  }\n}\n\nfunction reducer(state, action) {\n  switch(action.type) {\n    case \"TOGGLE_MULTIPLE\": {\n      const currentAnswers = [...state.answers[action.linkId]];\n      const answerIndex = currentAnswers.findIndex(x => x.valueCoding.code === action.value.valueCoding.code);\n      if (answerIndex > -1) {\n        currentAnswers.splice(answerIndex, 1);\n      } else {\n        currentAnswers.push(action.value);\n      }\n      return {\n        ...state,\n        answers: {\n          ...state.answers,\n          [action.linkId]: currentAnswers\n        }\n      };\n    }\n\n    case \"TOGGLE_SINGLE\": {\n      return {\n        ...state,\n        answers: {\n          ...state.answers,\n          [action.linkId]: state.answers[action.linkId].findIndex(\n            x => x.valueCoding.code === action.value.valueCoding.code\n          ) > -1 ? [] : [action.value]\n        }\n      };\n    }\n\n    case \"SET_URI\":\n      const answers = {\n          ...state.answers,\n          [action.linkId]: [{ valueUri: action.value }]\n      }\n      return {\n        ...state,\n        answers\n      }\n    default:\n        return state\n  }\n}\n\nfunction getPath(obj, path = \"\") {\n    return path.split(\".\").reduce((out, key) => out ? out[key] : undefined, obj)\n}\n\nfunction Question({ text, extension = null, linkId, state, dispatch }) {\n  let label = text;\n  let note  = null;\n\n  if (Array.isArray(extension)) {\n    let ext = extension.find(x => x.url === \"http://fhir-registry.smarthealthit.org/extensions/questionnaire-item-label\");\n    if (ext && ext.valueString) {\n      note = label;\n      label = ext.valueString;\n    }\n  }\n  return (\n    <div className=\"col-lg-6\" style={{ marginBottom: \"3rem\" }}>\n      <h4 className=\"text-success\">{ label }</h4>\n      <hr/>\n      { note && <p className=\"form-text\">{ note }</p> }\n      <Answers questionId={linkId} state={state} dispatch={dispatch}/>\n    </div>\n  );\n}\n\nfunction Answers({ questionId, state, dispatch }) {\n  const question = questionnaire.item.find(x => x.linkId === questionId);\n  \n  if (question.type === \"choice\") {\n\n    const { concept, system } = questionnaire.contained.find(\n      x => `#${x.id}` === question.answerValueSet\n    ).compose.include[0];\n\n    if (question.repeats) {\n      return <>{concept.map(currentAnswer => <CheckBox\n          key={`${questionId}_${currentAnswer.code}`}\n          attrs={{\n            name: currentAnswer.code,\n            checked: state.answers[questionId].findIndex(x => x.valueCoding.code === currentAnswer.code) > -1,\n            onChange: () => {\n              dispatch({\n                type: \"TOGGLE_MULTIPLE\",\n                linkId: questionId,\n                value: {\n                  valueCoding: {\n                      system,\n                      code: currentAnswer.code,\n                      display: currentAnswer.display\n                  }\n                }\n              });\n            }\n          }}\n          label={ currentAnswer.display }\n          description={ getPath(currentAnswer, \"designation.0.value\") || null }\n        />)}</>;\n    }\n\n    else {\n      return <>{concept.map(currentAnswer => <CheckBox\n          key={`${questionId}_${currentAnswer.code}`}\n          attrs={{\n            name: currentAnswer.code,\n            type: \"radio\",\n            checked: state.answers[questionId].findIndex(x => x.valueCoding.code === currentAnswer.code) > -1,\n            onChange: () => {\n              dispatch({\n                type: \"TOGGLE_SINGLE\",\n                linkId: questionId,\n                value: {\n                  valueCoding: {\n                      system,\n                      code: currentAnswer.code,\n                      display: currentAnswer.display\n                  }\n                }\n              });\n            }\n          }}\n          label={ currentAnswer.display }\n          description={ getPath(currentAnswer, \"designation.0.value\") || null }\n        />)}</>;\n    }\n  }\n  else if (question.type === \"url\") {\n    return <URLInput\n           linkId={questionId}\n           value={getPath(state, `answers.${questionId}.0.valueUri`) || null}\n           onChange={e => void dispatch({ type: \"SET_URI\", linkId: questionId, value: e.target.value })}\n           required={!!question.required}\n         />\n  }\n\n  return null;\n}\n\nfunction App() {\n\n  /** @type {any} */\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <div className=\"App\">\n      <nav className=\"navbar sticky-top navbar-expand-lg navbar-light bg-light\">\n        <div className=\"container\">\n          <a className=\"navbar-brand\" href=\"/\">\n            <img src={logo} className=\"App-logo\" alt=\"logo\" style={{\n              height: \"1.4em\",\n              verticalAlign: \"top\",\n              marginRight: \"1ex\"\n            }} /> Privacy Manifest Builder\n          </a>\n        </div>\n      </nav>\n      <main className=\"container\" style={{ fontSize: \"14px\" }}>\n        <br/>\n        <br/>\n        <form onSubmit={e => e.preventDefault()} className=\"needs-validation\">\n          <div className=\"row\">\n            { questionnaire.item.map(item => <Question key={item.linkId} { ...item } state={state} dispatch={dispatch}/>) }\n          </div>\n          <div className=\"card\">\n            <h4 className=\"card-header\">\n              <a\n                onClick={beforeDownload} \n                className={\"btn btn-primary float-right\"}\n                href={\"data:application/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(generateQuestionnaireResponse(state), null, 2))}\n                download=\"privacy-manifest.json\"\n                style={{ margin: \"-4px 0\" }}\n              >Download</a>\n              Privacy Manifest { !checkStateValidity(state) && <small><b style={{ verticalAlign: \"text-top\"}} className=\"badge badge-danger\">Invalid</b></small> }\n            </h4>\n            <div className=\"card-body\">\n            <SyntaxHighlighter customStyle={{ background: \"#FFF\" }} language=\"json\" style={atomOneLight}>{\n                JSON.stringify(generateQuestionnaireResponse(state), null, 2)    \n            }</SyntaxHighlighter>\n            </div>\n          </div>\n        </form>\n        <br/>\n        <br/>\n        <br/>\n        <br/>\n      </main>\n      <nav className=\"navbar fixed-bottom navbar-light bg-light\">\n        <div className=\"container\">\n          <div className=\"text-muted\">\n            Read more about the SMART Privacy Manifest <a href=\"/\" target=\"_blank\" rel=\"noreferrer\">here</a>\n          </div>\n        </div>\n      </nav>\n    </div>\n  );\n}\n\nfunction URLInput({ linkId, value, onChange, required = false}) {\n  return <input\n    className=\"form-control\"\n    type=\"url\"\n    name={linkId}\n    id={linkId}\n    placeholder=\"https://example.com\"\n    required={required}\n    pattern=\"^https?://.+\"\n    value={value || ''}\n    onChange={onChange}\n  />\n}\n\nfunction CheckBox({ attrs, label, description }) {\n  return (\n    <div className=\"form-check\">\n      <label className=\"form-check-label\">\n        <input\n          type=\"checkbox\"\n          { ...attrs }\n          className=\"form-check-input\"\n        /> { label }\n        { description && <p className=\"text-muted\">{ description }</p> }\n      </label>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}